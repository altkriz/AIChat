<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KrizVibe — RP Character Chat (Glass + Long-Term Memory)</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <!-- Feather Icons -->
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

  <!-- Marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Custom Styles -->
  <link href="css/style.css" rel="stylesheet" />
</head>

<body>
  <!-- Mobile Sidebar Overlay -->
  <div id="sidebar-overlay" class="sidebar-overlay md:hidden"></div>

  <div class="min-h-screen p-4 md:p-6 flex justify-center items-center">
    <div class="w-full max-w-6xl card overflow-hidden flex flex-col h-[90vh] md:h-auto">

      <div class="accent-line shrink-0"></div>

      <div class="flex-1 flex overflow-hidden relative">
        
        <!-- SETTINGS SCREEN / SIDEBAR -->
        <aside class="sidebar md:static md:block md:w-1/3 p-6 border-r border-white/10 overflow-y-auto w-full">

          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div class="w-14 h-14 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex justify-center items-center text-white shadow-lg font-bold text-xl">AI</div>
              <div>
                <h3 class="text-lg font-bold leading-tight">KrizVibe<br>RP Engine</h3>
              </div>
            </div>
            <!-- Mobile Close Button (only visible when sidebar is open on mobile, managed by JS toggling class if needed, or just click overlay) -->
             <button class="md:hidden text-white/70 hover:text-white" onclick="toggleSidebar()">
              <i data-feather="x"></i>
            </button>
          </div>

          <p class="meta mb-4">Glass UI • Long-Term Memory • Story Persistence</p>

          <!-- Inputs -->
          <div class="space-y-4">

            <div>
              <label class="text-sm font-semibold text-indigo-200">Your Name</label>
              <input id="user-name-input" class="w-full mt-1 p-2 rounded bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors" placeholder="e.g. Alex">
            </div>

            <div>
              <label class="text-sm font-semibold text-indigo-200">Character Name</label>
              <input id="character-name-input" class="w-full mt-1 p-2 rounded bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors" placeholder="e.g. Luna">
            </div>

            <div>
              <label class="text-sm font-semibold text-indigo-200">Avatars (URL)</label>
              <div class="space-y-2 mt-1">
                <input id="user-avatar-input" class="w-full p-2 rounded bg-white/5 border border-white/10 text-xs focus:border-indigo-500 focus:outline-none" placeholder="Your Avatar URL (optional)">
                <input id="char-avatar-input" class="w-full p-2 rounded bg-white/5 border border-white/10 text-xs focus:border-indigo-500 focus:outline-none" placeholder="Character Avatar URL (optional)">
              </div>
            </div>

            <div>
              <label class="text-sm font-semibold text-indigo-200">Character Sheet</label>
              <textarea id="character-sheet-input" rows="4" class="w-full mt-1 p-2 rounded bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors text-sm" placeholder="Describe personality, appearance, background...">Luna is a cosmic librarian with soft humor, gentle mystery, and poetic tone.</textarea>
            </div>

            <div>
              <label class="text-sm font-semibold text-indigo-200">Player Notes (Flavor)</label>
              <textarea id="player-notes-input" rows="2" class="w-full mt-1 p-2 rounded bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors text-sm">Avoid political tension. Keep replies PG-13. Slightly tease the user.</textarea>
            </div>

            <div>
              <label class="text-sm font-semibold text-indigo-200">World Rules</label>
              <textarea id="world-rules-input" rows="2" class="w-full mt-1 p-2 rounded bg-white/5 border border-white/10 focus:border-indigo-500 focus:outline-none transition-colors text-sm">Always stay in character. No OOC. No breaking 4th wall.</textarea>
            </div>

             <div class="pt-2 border-t border-white/10">
              <label class="text-sm font-semibold text-indigo-200">API URL (KoboldCpp)</label>
              <input id="api-url-input" class="w-full mt-1 p-2 rounded bg-white/5 border border-white/10 text-xs font-mono focus:border-indigo-500 focus:outline-none" value="https://koboldai-koboldcpp-tiefighter.hf.space/api/v1/generate">
            </div>

            <!-- START -->
            <button id="start-chat-button" class="w-full mt-4 p-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold shadow-lg transform active:scale-95 transition-all">
              Start / Continue Chat
            </button>

            <div class="grid grid-cols-2 gap-2 mt-2">
              <button id="clear-history" class="p-2 rounded bg-white/5 hover:bg-red-500/20 text-white/70 text-xs transition-colors">Clear History</button>
              <button id="export-btn" class="p-2 rounded bg-white/5 hover:bg-white/10 text-white/70 text-xs transition-colors">Export Transcript</button>
            </div>

            <div class="flex gap-2 mt-2 text-sm justify-center">
              <input id="persist-switch" type="checkbox" checked class="accent-indigo-500">
              <label class="text-white/70 select-none cursor-pointer" for="persist-switch">Persist Chat</label>
            </div>

            <!-- MEMORY PANEL TOGGLE -->
            <button id="toggle-memory" class="w-full mt-4 p-2 rounded bg-white/5 hover:bg-white/10 transition flex items-center justify-center gap-2 text-sm font-semibold text-indigo-300">
              <i data-feather="database" class="w-4 h-4"></i> Long-Term Memory
            </button>

            <!-- MEMORY PANEL -->
            <div id="memory-panel" class="panel-hidden mt-3 p-3 rounded bg-black/20 border border-white/5 space-y-3 text-xs">

              <div>
                <h4 class="font-bold text-indigo-400 mb-1">Facts</h4>
                <div id="mem-facts" class="text-white/70 pl-2 border-l-2 border-indigo-500/30"></div>
              </div>

              <div>
                <h4 class="font-bold text-pink-400 mb-1">Relationships</h4>
                <div id="mem-relationships" class="text-white/70 pl-2 border-l-2 border-pink-500/30"></div>
              </div>

              <div>
                <h4 class="font-bold text-emerald-400 mb-1">World Lore</h4>
                <div id="mem-world" class="text-white/70 pl-2 border-l-2 border-emerald-500/30"></div>
              </div>

              <div>
                <h4 class="font-bold text-amber-400 mb-1">Events</h4>
                <div id="mem-events" class="text-white/70 pl-2 border-l-2 border-amber-500/30"></div>
              </div>

              <div>
                <h4 class="font-bold text-blue-400 mb-1">Emotion State</h4>
                <div id="mem-emotion" class="text-white/70"></div>
              </div>

              <button id="memory-clear" class="w-full p-2 rounded bg-red-500/20 hover:bg-red-500/40 text-red-200 mt-2 transition-colors">Clear Memory</button>
            </div>

          </div>
        </aside>

        <!-- CHAT AREA -->
        <main class="w-full md:w-2/3 p-4 md:p-6 flex flex-col h-full relative">

          <!-- Header -->
          <div class="flex items-center gap-3 mb-4 shrink-0 pb-2 border-b border-white/5">
            <button id="menu-toggle" class="md:hidden p-2 -ml-2 text-white/80 hover:text-white">
              <i data-feather="menu"></i>
            </button>

            <div id="char-avatar" class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex justify-center items-center font-bold text-lg shadow-inner bg-cover bg-center">C</div>
            <div class="overflow-hidden">
              <div id="character-name-display" class="text-lg md:text-xl font-bold truncate">Character</div>
              <div id="character-bio-mini" class="text-xs md:text-sm text-white/50 truncate">Bio preview...</div>
            </div>
          </div>

          <!-- CHAT MESSAGES -->
          <div id="chatbox" class="flex-1 overflow-y-auto pr-2 space-y-4 scroll-smooth">
            <!-- Messages will appear here -->
            <div class="text-center text-white/30 text-sm mt-10 italic">
              Configure your character in the settings and press Start to begin.
            </div>
          </div>

          <!-- Typing -->
          <div id="typing-indicator" class="mt-3 hidden flex gap-2 items-center meta shrink-0">
            <div class="typing-dots">
              <span></span><span></span><span></span>
            </div>
            <div id="typing-text" class="text-xs text-indigo-300">Typing…</div>
          </div>

          <!-- INPUT -->
          <div class="mt-4 shrink-0 relative flex items-end gap-2 bg-white/5 p-2 rounded-2xl border border-white/10 focus-within:border-indigo-500/50 focus-within:bg-white/10 transition-all">
            <textarea id="user_input" class="flex-1 bg-transparent border-none focus:ring-0 text-white px-3 py-2 text-sm max-h-32 min-h-[44px]" placeholder="Type a message..." rows="1"></textarea>
            <button id="send_button" class="p-3 mb-[2px] rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg hover:shadow-indigo-500/20 active:scale-95 transition-all">
              <i data-feather="send" class="w-5 h-5"></i>
            </button>
          </div>

        </main>
      </div>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>
